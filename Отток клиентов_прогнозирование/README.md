# Проект - Телекоммуникации
Задача - компания оператор связи планирует внедрить прогноз оттока клиентов для своевременного принятия мер по предотвращению.
В распоряжении персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

Оператор предоставляет два основных типа услуг:
- Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно.
- Интернет. Подключение может быть двух типов: через телефонную линию (DSL, от англ. digital subscriber line, «цифровая абонентская линия») или оптоволоконный кабель (Fiber optic).

Также доступны такие услуги:
- Интернет-безопасность: антивирус (DeviceProtection) и блокировка небезопасных сайтов (OnlineSecurity);
- Выделенная линия технической поддержки (TechSupport);
- Облачное хранилище файлов для резервного копирования данных (OnlineBackup);
- Стриминговое телевидение (StreamingTV) и каталог фильмов (StreamingMovies).

За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека.

## Ход работы:
1. Изучить таблицы по отдельности:
- head, info, describe
- проверить пропуски
- проверить дубликаты
- проверить качество и типы данных 
- построить распределения ключевых признаков для выявления явных закономерностей
- обработка / создание доп. признаков
2. Объединить таблицы в одну
- заполнить NaN
- проверить коллинеарность факторов
- определить целевой признак
- определение признаков для обучения и удаление лишних признаков
- разделить данные на две выборки
- закодировать данные, если требуется
3. МО
- определение используемых моделей
- обучение моделей с подбором гиперпараметров
- выбор дополнительных метрик на кросс-валидации для оценки в случае близких показателей: время обучения, recall, precision, ...
- составление рейтинга моделей и определение лучшей
- проверка качества модели на тестовой выборке
- оценка важности признаков, применение матрицы ошибок
4. Подготовка комплексного отчета

#### Цель исследования - проверить достижимость метрики, привязанной к прогнозу оттока клиентов, ROC-AUC = 0.85 на предоставленном датасете с помощью алгоритмов машинного обучения. 

#### Исходные данные
- датасет разбит на четыре таблицы с соотв. информацией о контрактах с действующими и ушедшими клиентами, в каждой таблице есть один общий параметр - customerID
- в данных нет пропусков и аномалий, масштабирование признаков не требуется
- целевой признак должен базироваться на признаке EndDate - задача классификации
- каждая таблица была исследована по отдельности, основные результаты наблюдений:
  - в базовой таблице 'contracts' 7043 записи
  - дубликатов не выявлено
  - заполнены технические пробелы в поле TotalCharges значениями из поля MonthlyCharges (пробелы связаны с совпадением даты заключения договора с датой выгрузки датасета - 01.02.2020), изменен тип данных на числовой
  - создан целевой признак 'status': 0 - контракт закончен, 1 - контракт активен.
  - для повышения точности моделирования создан дополнительный признак 'active_days' - продолжительность действия контракта в днях по 01.02.2020

#### Распределения данных:
- пиковые периоды заключения контрактов: начало 2014г и конец 2019г
- динамика заключения контрактов отрицательная с 2014г по 2017, рост с 2017 по 2020
- контрактов с типом месяц к месяцу 3800, годовых - 1500 и двух-годичных 1600 единиц
- активных контрактов на 01.02.2020  - 5942
- кол-во контрактов снижается по окололинейному закону к их продолжительности действия кроме пика в 2100 дней - связано с пиком заключения двух-годичных контрактов в 2014 году
- месячные платежи по завершенным контракта выше платежей по действующим контрактам

#### Объединение таблиц:
- запонены отсутствующие значения по доп. услугам internet в логике их отсутствия в контрактах
- пропуски в поле MultipleLines заполнены третьей категорией 'unknown', т.к. логика пропуска неизвестна
- построена матрица коллинеарности - выявлена мультиколлинеарность между несколькими признакам -> линейные модели не применимы

#### Машинное обучение прогнозынх моделей:
- датасет был разбит на две выборки: train/test в пропорции 75:25, т.к. размер данных не позволяет делить на три выборки
- в признаки вошли все поля таблиц кроме status (целевой), customerID, BeginDate (провоцирует утечку) и EndDate (провоцирует утечку), также добвлен дополнительный - active_days
- признаки закодированы методом Ordinal Encoder
- методом кросс-валидации было обучено 3 модели: CatBoostClassifier, LGBM Classifier и Random Dorest Classifier.
- модель с лучшим показателем ROC-AUC = 0.857 на тренировочной выборке и 0.925 на тестовой оказалась CatBoostClassifier
- лучшие гиперапараметры подбирались оптимизатором GridSearchCV: 'depth' - 5, 'iterations' - 500, 'learning_rate' - 0.1
- список всех используемых для обчучения признаков: 'Type', 'PaperlessBilling', 'PaymentMethod', 'MonthlyCharges',	'TotalCharges',	'active_days',	'gender',	'SeniorCitizen',	'Partner',	'Dependents',	'InternetService',	'OnlineSecurity',	'OnlineBackup',	'DeviceProtection',	'TechSupport',	'StreamingTV',	'StreamingMovies',	'MultipleLines'
- признаки с наибольшим весом: active_days, MonthlyCharges, TotalCharge и Type.

В рузьтате обучения модели CatBoost Classifier на тренировочной выборки было достигнуто значение целевой метрики ROC-AUC = 0,857. На тестовой - 0.925, целевой уровень (0.85 и выше) достигнут.

Лучшие параметры из сетки: 'depth' - 5, 'iterations' - 500, 'learning_rate' - 0.1,

Время обучения: 5min 7s

Признаки с наибольшим весом: active_days, MonthlyCharges, TotalCharge и Type.

Истинноположительных предсказаний - 1464 (83.13% от всего кол-ва предсказаний)
Истинноположительных отрицательных - 155
Ложноположительных - 121
Ложноотрицательных - 21
